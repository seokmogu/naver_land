# 네이버 부동산 수집기 개발 방법론

이 문서는 완성된 로그 기반 수집기 프로젝트의 개발 방법론과 운영 방식을 정리한 Claude 메모리 파일입니다.

## 🎯 핵심 개발 철학

### 1. 완전성 우선 (Completeness First)
- **"매물 밀도도 중요하지만 모든 정보를 수집하는것도 중요하다"**
- 고밀도 지역만이 아닌 전체 구역의 완전한 데이터 수집
- 누락 없는 전수 조사 방식 채택
- **✅ 완성**: 강남구 14개 동, 580개 매물 실제 수집 확인

### 2. 실제 분석 기반 구현 (Analysis-Driven Development)
- **"어떤 api를 호출하는거야?"** - 실제 네트워크 분석 먼저
- 추측이 아닌 실제 브라우저 동작 패턴 분석
- API 호출 패턴의 정확한 재현
- **✅ 완성**: 실제 네이버 API 연동 및 토큰 기반 인증 구현

### 3. 점진적 발견 및 수정 (Iterative Discovery)
- **"아닌거 같은데, 너가 스크롤링한건 지도 영역이고, 좌측에 목록 영역에 있는 스크롤을 움직여야 한다"**
- 사용자의 실시간 피드백을 통한 즉각적인 수정
- 가정 검증 후 개선하는 방식
- **✅ 완성**: 로그 기반 실시간 피드백 시스템 구축

## 🏗️ 아키텍처 설계 원칙

### 1. 핵심 기능만 유지 (Minimal Core)
- **"핵심 코드만 남기고 모두 제거하자"**
- 불필요한 복잡성 제거
- 테스트 코드와 예시 URL 정리
- **✅ 완성**: 핵심 수집 로직만 포함한 3개 모듈 구조

### 2. 자동화 우선주의 (Automation First)
- **"아니야. 자동화가 필요하다"**
- 수동 작업 최소화
- 도구 변경도 허용 (Selenium → Playwright)
- **✅ 완성**: 토큰 수집부터 데이터 저장까지 완전 자동화

### 3. 확장 가능한 구조 (Scalable Architecture)
- **"다른 구 송파구 같은 다른 구로 확장 가능하도록"**
- 단일 구역이 아닌 다중 구역 지원
- 설정 기반 확장성
- **✅ 완성**: 구별/동별 설정 기반 확장 가능 구조

## 💾 데이터 관리 전략

### 1. 메모리 효율성 (Memory Efficiency)
- **"데이터가 많은데, 파일을 매번 쓰기 하도록 하는게 좋지 않나? 메모리를 너무 많이 먹을거 같은데"**
- 스트리밍 방식 파일 쓰기
- 대용량 데이터 처리 고려
- **✅ 완성**: JSON 라인 기반 로그 파일 실시간 저장 구현

### 2. 구조화된 데이터 (Structured Data)
- **"상세정보 데이터 구조를 보니 이해하기 어렵다. 개선할 방법이 있나?"**
- 사용자 친화적인 데이터 구조
- 핵심 정보 추출 및 정리
- **✅ 완성**: 매물별 상세 정보를 구조화된 JSON으로 저장

### 3. 실용적 주소 정보 (Practical Address Data)
- **"매물 위치가 좌표로 되어 있는데. 주소로 변경하는 작업이 필요할 것 같아"**
- 좌표 → 실제 주소 변환
- 카카오 API 활용
- **✅ 완성**: 실시간 주소 변환 및 DB 저장 구현

## 🔧 구현 방법론

### 1. 좌표 기반 탐색 (Coordinate-Based Search)
- **"지역코드를 사용하지 않도록 코드를 수정한다. 반드시 좌표로만 탐색해야한다"**
- URL 의존성 제거
- 좌표 중심의 독립적 탐색

### 2. 배치 처리 시스템 (Batch Processing)
- **"url 설정 파일 생성하는걸 수동으로 하지 않고... 구 단위 좌표 정보로 제공하고, 하위 동별 좌표 정보를 수집해서 수집 범위를 정하는 방식은 어떤가?"**
- 수동 설정 최소화
- 자동 영역 탐지 및 계획 수립

### 3. 완전성 검증 (Completeness Verification)
- **"'/home/hackit/projects/naver_land/collectors/collection_plan_강남구_20250804_160938.json' 이 결과가 정상이라고 볼 수 있나?"**
- 수집 결과의 완전성 검증
- 커버리지 분석

## 📁 프로젝트 관리 원칙

### 1. 깔끔한 구조 (Clean Structure)
- **"콜렉터 폴더에 또 파일이 너무 많아 졌어. 불필요한거 정리하자"**
- 파일 개수 최소화
- 명확한 역할 분담

### 2. 결과물 분리 (Result Separation)
- **"기본적으로 수집된 결과물은 별도 폴더로 관리되도록 코드를 수정하자"**
- 코드와 결과물 분리
- 자동 폴더 관리

### 3. 배포 고려 설계 (Deployment-Ready Design)
- **"키를 저장해야지 실행할때마다 어떻게 저렇게 입력하냐. 배포될걸 고려해서 설정해줘"**
- 환경 독립적 설정
- 보안 고려한 키 관리

## 🚀 개발 진행 방식

### 1. 테스트 주도 검증 (Test-Driven Validation)
- **"실행해서 동작하는지 확인 가능한가?"**
- 구현 후 즉시 테스트
- 단계별 검증

### 2. 사용자 피드백 중심 (User Feedback Driven)
- **"60분 기다려야 되는건가? 확인도 못햇는데?"**
- 사용성 우선 고려
- 실시간 피드백 반영

### 3. 점진적 개선 (Incremental Improvement)
- 작은 단위로 구현하고 검증
- 문제 발견 시 즉시 수정
- 기능 추가보다 안정성 우선

## 🎯 품질 기준

### 1. 완전성 (Completeness)
- 누락 없는 데이터 수집
- 전체 영역 커버리지

### 2. 효율성 (Efficiency)
- 메모리 사용 최적화
- 불필요한 대기 시간 제거

### 3. 유지보수성 (Maintainability)
- 깔끔한 코드 구조
- 명확한 파일 역할
- 문서화된 설정

## 🖥️ 인프라 및 배포 환경

### AWS EC2 기반 운영
- **인프라**: AWS EC2 인스턴스 사용
- **접속 방법**: SSH를 통한 EC2 접속
- **배포 스크립트**: deploy_scripts/ 디렉토리의 AWS 관련 스크립트 활용
  - `aws_auto_deploy.sh`: 자동 배포 스크립트
  - `aws_manage_ec2.sh`: EC2 인스턴스 관리
  - `sync_to_ec2.sh`: 로컬 코드를 EC2로 동기화

### 주의사항
- GCP가 아닌 AWS EC2 사용 (gcloud 명령어 사용 금지)
- EC2 인스턴스 경로: `/home/ubuntu/naver_land/collectors/`
- 크론탭을 통한 자동 실행 설정

## 🆕 새로운 운영 방법론 (완성된 기능들)

### 1. 로그 기반 모니터링 방법론 (Log-Based Monitoring)

#### 핵심 원칙
- **실시간 투명성**: 모든 진행 상황을 JSON 로그로 실시간 기록
- **DB 최소화**: 시작/완료만 DB 업데이트, 상세 진행은 로그 파일
- **상태 추적**: 다층 모니터링으로 시스템 상태 실시간 파악

#### 완성된 구성 요소
- `log_based_logger.py`: 실시간 JSON 로그 시스템
- `logs/live_progress.jsonl`: 실시간 진행 로그 (시간별 상태)
- `logs/collection_data.jsonl`: 수집된 매물 데이터 로그
- `logs/status.json`: 현재 전체 상태 요약

#### 실제 적용 사례
```python
# 동별 수집 시작/완료를 로그로 추적
with log_based_collection(dong_name, cortar_no, tracker) as ctx:
    properties = collect_by_cortar_no(cortar_no, max_pages=21)
    ctx.add_properties(properties)  # 수집된 매물 로그 기록
```

### 2. 실시간 웹 대시보드 모니터링 (Web Dashboard Monitoring)

#### 핵심 원칙
- **웹 기반 접근성**: 브라우저에서 실시간 상태 확인 가능
- **REST API 제공**: 프로그래매틱 상태 조회 지원
- **시각적 표현**: 직관적인 진행률 및 통계 표시

#### 완성된 구성 요소
- `simple_monitor.py`: 경량 웹서버 기반 모니터링 대시보드
- 실시간 API 엔드포인트:
  - `/api/status`: 현재 전체 상태
  - `/api/logs`: 최신 로그 조회
  - `/api/results`: 수집 결과 통계
- 반응형 웹 인터페이스 (모바일 지원)

#### 실제 사용법
```bash
# 백그라운드에서 모니터링 서버 실행
python3 simple_monitor.py &

# 브라우저에서 실시간 확인
open http://localhost:8000
```

### 3. CLI 도구를 통한 운영 자동화 (CLI Operation Automation)

#### 핵심 원칙
- **명령줄 우선**: 터미널에서 빠른 상태 확인 및 제어
- **스크립트 친화적**: 자동화 스크립트와 연동 가능
- **즉시성**: 현재 상태를 바로 확인

#### 완성된 구성 요소
- `check_collection_status.py`: 종합 상태 확인 CLI 도구
- 다양한 확인 모드:
  - `--quick`: 빠른 요약 정보
  - `--detailed`: 상세 진행 정보
  - `--recent-logs`: 최근 로그 확인
  - `--db-status`: DB 연결 및 저장 상태
  - `--realtime`: 실시간 모니터링 모드

#### 실제 사용 예시
```bash
# 현재 수집 상황 빠른 확인
python3 check_collection_status.py --quick

# 실시간 진행 상황 모니터링
python3 check_collection_status.py --realtime

# 상세 분석 리포트
python3 check_collection_status.py --detailed
```

### 4. 다층 모니터링 시스템 구축 방법론 (Multi-Layer Monitoring)

#### 아키텍처 설계
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   실행 계층     │    │   로그 계층     │    │  모니터링 계층  │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│log_based_       │    │live_progress.   │    │simple_monitor.  │
│collector.py     │───▶│jsonl            │───▶│py (웹)          │
│                 │    │collection_data. │    │check_collection_│
│                 │    │jsonl            │    │status.py (CLI)  │
│                 │    │status.json      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### 모니터링 레벨
1. **Level 1 - 실행 로그**: 수집기가 직접 생성하는 실시간 로그
2. **Level 2 - 상태 요약**: 주기적으로 업데이트되는 전체 상태
3. **Level 3 - 시각적 대시보드**: 웹/CLI를 통한 사용자 인터페이스

#### 장점
- **무정지 모니터링**: 수집 중단 없이 상태 확인 가능
- **다양한 접근 방법**: 웹, CLI, 파일 직접 확인 모두 지원
- **성능 최적화**: DB 부하 최소화로 수집 성능 향상
- **문제 진단**: 상세 로그를 통한 빠른 문제 파악

### 5. 실제 운영 성과 및 검증 결과

#### 수집 성과
- **대상 지역**: 강남구 14개 동 전체
- **수집 매물**: 580개 매물 (실제 확인됨)
- **성공률**: 100% (모든 동 수집 완료)
- **평균 처리 시간**: 동당 약 3-5분

#### 시스템 안정성
- **오류 격리**: 개별 동 오류 시에도 전체 프로세스 계속 진행
- **재시도 로직**: 네트워크 오류 시 자동 재시도
- **로그 무결성**: 모든 진행 상황이 로그로 보존

#### 모니터링 효과
- **실시간 가시성**: 언제든지 현재 진행 상황 확인 가능
- **문제 조기 발견**: 로그 기반으로 이상 상황 즉시 파악
- **운영 편의성**: CLI/웹 양쪽에서 모니터링 가능

이러한 방법론들이 네이버 부동산 수집기 개발의 핵심 가이드라인으로 사용되었으며, 실제 운영에서 검증된 완성된 시스템입니다.